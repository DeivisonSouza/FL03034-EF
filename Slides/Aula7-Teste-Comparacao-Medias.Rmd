---
title: "Experimentação Florestal (FL03034 - EF)"
subtitle: "Testes de Comparações de Médias"
author: "Prof. Dr. Deivison Venicio Souza"
institute: "Universidade Federal do Pará (UFPA)"
date: 
encoding: "UTF-8"
header-includes: 
   - \usepackage{xcolor}
   - \usepackage{amsmath}
output:
  xaringan::moon_reader:
    css:
      - default
      - assets/sydney-fonts.css
      - assets/slide-title/sydney-title.css
    self_contained: false
    seal: false
    includes:
      in_header: "assets/mathjax-equation-numbers.html"
    nature:
      beforeInit: ["assets/remark-zoom.js", "https://platform.twitter.com/widgets.js"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      highlightLanguage: ["r", "css", "yaml"]
      ratio: '16:9'
      navigation:
        scroll: false
---
class: title-slide, center, middle
background-image: url(fig/slide-title/ufpa2.png), url(fig/slide-title/forest.png), url(fig/slide-title/img3.png)
background-position: 84% 90%, 95% 90%
background-size: 220px, 90px, cover

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	error = FALSE,
	fig.align = "center",
	fig.showtext = TRUE,
	message = FALSE,
	warning = FALSE,
	cache = FALSE,
	collapse = TRUE,
	dpi = 600
)
```

```{r packages, include=FALSE}
# remotes::install_github("dill/emoGG")
library(ggplot2)
library(dplyr)
library(ggimage)
library(kableExtra)
library(readr)
```

```{r xaringan-logo, echo=FALSE}
library(xaringanExtra)
use_logo(
  image_url = "fig/slide-title/ufpa.png",
  position = css_position(top = ".8em", right = "-.5em"),
  width = "140px",
  height = "140px"
)

use_extra_styles(
  hover_code_line = TRUE,         #<<
  mute_unhighlighted_code = TRUE  #<<
)
xaringanExtra::use_editable(expires = 1)
#.can-edit[Você pode editar este título de slide]
#.can-edit.key-firstSlideTitle[Change this title and then reload the page]
use_clipboard()
```

```{r, load_refs, include=FALSE, cache=FALSE}
library(RefManageR)
BibOptions(check.entries = FALSE,
           bib.style = "authoryear",
           cite.style = "authoryear",
           style = "html",
           hyperlink = FALSE,
           dashed = FALSE)
(myBib <- ReadBib("./bib/ref.bib", check = FALSE))
```

```{r icon, echo=FALSE}
#remotes::install_github("mitchelloharawild/icons")
#remotes::install_github('emitanaka/anicon')
#library(icons)
#download_fontawesome()
#download_simple_icons()
```

```{r customDT, echo=F}
CustomDT <- function(data){
  data %>% DT::datatable(editable = 'cell', rownames = FALSE,
                         style = "default",
                         class = "compact", width = '550px',
                         caption = '',
     options=list(pageLength = 10, dom = 't', autoWidth = F,
                  columnDefs = list(list(className = 'dt-center', targets = "_all")),
       initComplete = htmlwidgets::JS(
          "function(settings, json) {",
          paste0("$(this.api().table().container()).css({'font-size': '", "10pt", "'});"),
          "}")
       ) 
     ) 
}
```

```{r customDT2, echo=F}
CustomDT2 <- function(data){
  data %>% DT::datatable(editable = 'cell', rownames = FALSE,
                         style = "default",
                         class = "compact", width = '450px',
                         caption = '',
     options=list(pageLength = 24, dom = 't', autoWidth = F,
                  columnDefs = list(list(className = 'dt-center', targets = "_all")),
       initComplete = htmlwidgets::JS(
          "function(settings, json) {",
          paste0("$(this.api().table().container()).css({'font-size': '", "8pt", "'});"),
          "}")
       ) 
     )
}
```



```{r customkbl, echo=F}
Customkbl <- function(data){
  data %>%
    kbl() %>%
    kable_classic(full_width = F, html_font = "Cambria") %>% 
  kable_paper(bootstrap_options = "striped", full_width = F) %>% 
  kable_styling(bootstrap_options = "striped", font_size = 18, position = "center") %>% 
  row_spec(1:4, color = 'black', background = 'white') %>% 
  row_spec(0, color = 'white', background = 'black') %>% 
  column_spec(1, color = 'white', background = 'black')
}
```


<!-- title-slide -->
# Experimentação Florestal <br> (FL03034 - EF)

## Testes de Comparações <br> de Médias `r anicon::faa("pagelines", animate="horizontal", colour="green")`

#### **Prof. Dr. Deivison Venicio Souza**
##### Universidade Federal do Pará (UFPA) 
##### Faculdade de Engenharia Florestal
##### E-mail: deivisonvs@ufpa.br
<br>
##### 1ª versão: 13/setembro/2021 <br> (Atualizado em: `r format(Sys.Date(),"%d/%B/%Y")`)
##### Altamira, Pará

---

layout: true
<div class="my-header"></div>
<div class="my-footer"><span>Prof. Dr. Deivison Venicio Souza (E-mail: deivisonvs@ufpa.br)&emsp;&emsp;&emsp;&emsp;&emsp; <div3>Experimentação Florestal (FL03034 - EF) </div3>/ <div2>Testes de Comparação de Médias</div2> </div>

---

## Ementa da disciplina (FL03034 - EF)

.shadow3[
<br>
1 - Introdução à experimentação; 

2 - Princípios básicos da experimentação; 

3 - Fases da pesquisa experimental; 

4 - Delineamento Inteiramente Casualizado - DIC; 

5 - Delineamento em Blocos Casualizados - DBC;

6 - Delineamento em Quadrado Latino - DQL;

.orange[7 - Testes de comparação de médias]; 

8 - Ensaios Fatoriais;

9 - Análise de correlação linear simples;

10 - Análise de regressão linear simples e múltipla; e

11 - Introdução à linguagem R para análise de experimentos.

]

---

## Objetivos
<br><br>
Ao final desta aula espera-se que o discente seja capaz de...

.font90[
* Conhecer e entender os princípios de alguns testes de comparações de médias paramétricos.
* Entender quando é razoável (adequado) realizar testes de comparações de médias.
* Compreender e aplicar a matemática subjacente de dois dos principais testes de comparações de médias: Tukey e Duncan.
* Aprender a apresentar e interpretar os resultados de testes de comparações de médias.
* Realizar testes de comparações de médias usando a linguagem de programação R.
]

---

## Conteúdo

.pull-left-4[
.font80[
**Parte 1 - ANOVA e Teste F - Recapitulando**

[1 - Recapitulando - ANOVA e Teste F](#rec)

&nbsp;&nbsp;[1.1 - Hipóteses estatísticas do teste F](#hip)

&nbsp;&nbsp;[1.2 - Regras de decisão do teste F](#regras)

&nbsp;&nbsp;[1.3 - Rejeição da hipótese H<sub>0</sub> do teste F](#rej)

]
]

.pull-right-4[
.pull-down[
.font80[
**Parte 2 - Teste de comparações de médias de Tukey**

[1 - Teste de comparações de médias de Tukey](#tt)

&nbsp;&nbsp;[1.1 - Diferença Mínima Significativa](#dms)

&nbsp;&nbsp;[1.2 - Hipóteses estatísticas do Teste de Tukey](#hett)

&nbsp;&nbsp;[1.3 - Regras de decisão do Teste de Tukey](#rdtt)

&nbsp;&nbsp;[1.4 - Etapas para realização do Teste de Tukey](#prtt)

&nbsp;&nbsp;[1.5 - Aplicação do Teste de Tukey](#att)

&nbsp;&nbsp;&nbsp;&nbsp;[1.5.1 - Competição de procedências florestais <br> (Pimentel-Gomes; Garcia, 2002)](#cpf)

&nbsp;&nbsp;&nbsp;&nbsp;[1.5.2 - Teste de Tukey no R - Pacote agricolae](#ttr)

]
]
]

---

## Conteúdo

.pull-left-4[
.font80[
**Parte 3 - Teste de comparações de médias de Duncan**

[1 - Teste de comparações de médias de Duncan](#tcmd)

&nbsp;&nbsp;[1.1 - Amplitude Mínima Significante](#ams)

&nbsp;&nbsp;[1.2 - Hipóteses estatísticas do Teste de Duncan](#hetd)

&nbsp;&nbsp;[1.3 - Regras de decisão do Teste de Duncan](#rdtd)

&nbsp;&nbsp;[1.4 - Etapas para realização do Teste de Duncan](#ertd)

&nbsp;&nbsp;[1.5 - Aplicação do Teste de Duncan](#atd)

&nbsp;&nbsp;&nbsp;&nbsp;[1.5.1 - Composição de substratos na altura de Pinus oocarpa (Banzatto; Kronka, 2013)](#csapo)

&nbsp;&nbsp;&nbsp;&nbsp;[1.5.2 - Teste de Duncan no R - Pacote agricolae](#ttr)

]
]

---

layout: false
name: conc
class: inverse, top, right
background-image: url(fig/class3/arara.jpg)
background-size: cover

.font200[**.yellow[Parte 1] <br> .white[ANOVA e Teste F: <br> Recapitulando...]**] 

.left[.footnote[.white[Créditos: Imagem de IvaCastro por Pixabay].]]

---

layout: true
<div class="my-header"></div>
<div class="my-footer"><span>Prof. Dr. Deivison Venicio Souza (E-mail: deivisonvs@ufpa.br)&emsp;&emsp;&emsp;&emsp;&emsp; <div3>Experimentação Florestal (FL03034 - EF) </div3>/ <div2>Testes de Comparações de Médias</div2> </div>

---
name: rec
## Recapitulando...
<br>

.pull-left-4[
.font80[
**Antes de aprofundar sobre ".green[Testes de Comparações de Médias]" vamos resgatar algumas ideias discutidas até aqui...**
]
<br>

.font70[
- Um .green[experimento] é conduzido sob algum delineamento (DIC, DBC ou DQL) ou arranjo experimental para .green[avaliar os efeitos de tratamentos] sobre uma variável resposta "y" de interesse.
- Para isso, .green[dados] da variável resposta "y" .green[são coletados], e estes são usados para avaliar as evidências e realizar inferências.
- Após uma boa análise exploratória, uma abordagem estatística comum é a realização de uma .green[ANOVA], cujo modelo estatístico depende do delineamento experimental.
- Na ANOVA, o .green[teste F] é usado para avaliar, sob a ótica estatística, a existência de evidências de .green[igualdade entre as médias de tratamentos] (Hipótese H<sub>0</sub>).
]
]


.pull-right-4[
```{r echo=FALSE, out.width='70%', fig.align='center', fig.cap='', dpi=600}
knitr::include_graphics("https://media2.giphy.com/media/mDBBU8K7Np2UQs9Dqy/giphy.gif")
```
.font70[
.center[
(Available at [https://media.giphy.com](https://media.giphy.com), jul 19, 2021)
]
]
]

---
name: hip
## Recapitulando...
<br>
### ANOVA: Hipóteses estatísticas do teste F
<br>

.pull-left-10[
.font90[
**Hipótese de nulidade (H<sub>0</sub>):**
<br>

- Todos os possíveis contrastes, entre médias, são estatisticamente nulos.
- As médias dos tratamentos são estatisticamente todas iguais entre si.

]
]

.pull-left-10[
.font90[
**Hipótese de alternativa (H<sub>1</sub>):**
<br>

- Existe pelo menos um contraste, entre médias, estatisticamente diferente de zero.
- Pelo menos dois tratamentos são estatisticamente diferentes entre si.
]
]

---
name: regras
## Recapitulando...
<br>
### ANOVA: Regras de decisão do teste F
<br>

.pull-left-10[
.font90[
**Rejeição da hipótese de nulidade (H<sub>0</sub>)**

- Se o valor da .green[estatística F] (F<sub>Calculado</sub>) for **maior** do que o .green[valor crítico na tabela da distribuição F-Snedecor], existem evidências para rejeitar H<sub>0</sub>.
- Em outras palavras, existem indícios de que pelo menos uma das médias dos tratamentos é estatisticamente diferente das demais, ao nível de significância fixado.

$F_{Calculado} > F_{Crítico}$

$Rejeita-se~~H_0$

]
]

.pull-right-10[
.font90[
**Não rejeição da hipótese de nulidade**

- Se o valor da .green[estatística F] (F<sub>Calculado</sub>) for **menor ou igual** do que o valor do (F<sub>Crítico</sub>), não existe evidências para rejeitar H<sub>0</sub>.
- Em outras palavras, existem indícios de que as médias dos tratamentos são estatisticamente todas iguais entre si, ao nível de significância fixado.
<br><br>

$F_{Calculado} \leq F_{Crítico}$

$Não~~rejeita-se~~H_0$

]
]

---
name: rej
## Recapitulando...
<br>
### ANOVA: Rejeição da hipótese H<sub>0</sub> do teste F

.pull-left-4[
.font80[
- Se $F_{calculado} > F_{crítico}$: existem evidências para rejeição da hipótese de nulidade (H<sub>0</sub>).
- Em outras palavras, existem evidências de que as médias de pelo menos dois tratamentos diferem estatísticamente.
<br><br>

**Note**: .green[O teste F não fornece evidências sobre qual é o melhor tratamento].
]
]

--

.pull-right-4[
.font80[
.center[**Surgiram duas novas perguntas...**]

.green[1 - Quais tratamentos .green[não possuem] médias significativamente diferentes?]

.green[2 - Quais tratamentos .green[possuem]  médias significativamente diferentes?]

- Para responder essas perguntas foram idealizados os .green[testes de comparações de médias].
- A ideia básica é realizar .green[comparações par-a-par] entre as médias dos tratamentos, e inferir se estas são significativamente diferentes (ou não).
- Portanto, os testes de comparações de médias complementam a ANOVA, quando a hipótese H<sub>0</sub> do teste F é rejeitada.
]
]

---

layout: false
name: conc
class: inverse, top, right
background-image: url(fig/class3/arara2.jpg)
background-size: cover

.font200[**.yellow[Parte 2] <br> .white[Teste de comparações <br> de médias de Tukey]**] 

.left[.footnote[.white[Créditos: Imagem de ljwong por Pixabay].]]

---

layout: true
<div class="my-header"></div>
<div class="my-footer"><span>Prof. Dr. Deivison Venicio Souza (E-mail: deivisonvs@ufpa.br)&emsp;&emsp;&emsp;&emsp;&emsp; <div3>Experimentação Florestal (FL03034 - EF) </div3>/ <div2>Testes de Comparações de Médias</div2> </div>

---
name: tt
## Teste de comparações de médias de Tukey
<br>
### John Wilder Tukey

.pull-left-4[
.font80[
- Foi idealizado por [John Wilder Tukey](https://en.wikipedia.org/wiki/John_Tukey) em 1949.
- **Publicação**: *Comparing Individual Means in the Analysis of Variance*
[(Tukey, 1949)](https://www.jstor.org/stable/3001913).
- **Ideia básica**: realizar .green[comparações par-a-par] entre as médias dos tratamentos, baseando-se na .green[Diferença Mínima Significativa] (DMS).
- É um dos principais e mais usados testes de comparações de médias.

]
]

.pull-right-4[
```{r echo=FALSE, out.width='50%', fig.align='center', fig.cap='John Wilder Tukey', dpi=600}
knitr::include_graphics("https://upload.wikimedia.org/wikipedia/en/thumb/e/e9/John_Tukey.jpg/220px-John_Tukey.jpg")
```

.font70[
.center[
**Fonte**: https://upload.wikimedia.org
]
]
]

---
name: dms
## Teste de comparações de médias de Tukey
<br>
### Diferença Mínima Significativa - DMS
<br>

.pull-left-4[
$$
\begin{equation*}
\Large
\Delta = q\sqrt{\frac{QMR}{J}}
\end{equation*}
$$
<br>
.font70[
$\Delta$ = Diferença Mínima de Significância

*q* = Amplitude Total Estudentizada

*QMR* = Quadrado Médio do Resíduo

*J* = Número de repetições por tratamento

*I* = Número de tratamentos
]
]

.pull-right-4[
.center[**Amplitude Total Estudentizada**]

$$
\begin{equation*}
q_{(I;~GLR,~\alpha)}
\end{equation*}
$$

.font70[
$I$ = Número de tratamentos

$GLR$ = Graus de liberdade de Resíduos (ou Erro Experimental)
<br><br>

- Encontre o valor de $q$ crítico no site: [q-Distribution-Tables-elvers](http://elvers.us/stats/tables/qprobability.html)

]
]

---

name: dms
## Teste de comparações de médias de Tukey
<br>
### Diferença Mínima Significativa - O que é?
<br>

.pull-left-2[
.font80[
- $\color{green}\Delta$ é o menor valor que a estimativa de um contraste (diferença entre médias) deve apresentar para admitir que existe diferença significativa entre as médias, ou seja, que a diferença é diferente de zero, sob a ótica estatística.
- Em outras palavras, $\color{green}\Delta$ é a diferença mínima que deve existir entre as médias de 2 tratamentos quaisquer, para que a hipótese H<sub>0</sub> seja rejeitada.
]
]

--

.pull-right-1[
.font70[
.center[**Vamos supor...**]

Supondo um experimento de crescimento em altura (centímetros) de plântulas em condições de viveiro. Têm-se os resultados das médias de 3 tratamentos para diferentes substratos (S1 = 20cm, S2 = 18cm e S3 = 17cm). Admitindo $\color{green}\Delta$ = 3, pergunta-se:

- Quais tratamentos diferem estatisticamente, em termos de suas médias?

S1 - S2 = 20 - 18 = .red[2]

S1 - S3 = 20 - 17 = .green[**3**]

S2 - S3 = 18 - 17 = .red[1]

]
]


---
name: hett
## Teste de comparações de médias de Tukey
<br>
### Hipóteses estatísticas do Teste de Tukey
<br>

.pull-left-10[
.font90[
**Hipótese de nulidade (H<sub>0</sub>):**
<br>

- As .green[médias] comparadas .green[não diferem] significativamente.

H<sub>0</sub>: $m_i - m_{i'} = 0$, para algum $i ≠ i'$

]
]

.pull-left-10[
.font90[
**Hipótese de alternativa (H<sub>1</sub>):**
<br>

- As .green[médias] comparadas .green[diferem] significativamente.

H<sub>1</sub>: $m_i - m_{i'} ≠ 0$, para algum $i ≠ i'$
]
]

---
name: rdtt
## Teste de comparações de médias de Tukey
<br>
### Regras de decisão do teste de Tukey
<br>

.pull-left-10[
.font90[
**Rejeição da hipótese de nulidade (H<sub>0</sub>)**

- Se $\left | m_i - m_{i'} \right | \geq \Delta$, rejeita-se (H<sub>0</sub>). 
- Em outras palavras, .green[existem evidências] de que as médias comparadas são diferentes, ao nível de significância $\alpha$.
]
]

.pull-right-10[
.font90[
**Não rejeição da hipótese de nulidade**

- Se $\left | m_i - m_{i'} \right | < \Delta$, não rejeita-se (H<sub>0</sub>). 
- Em outras palavras, .green[não existem evidências] de que as médias comparadas são diferentes, ao nível de significância $\alpha$.

]
]


---
name: prtt
## Teste de comparações de médias de Tukey
<br>
### Etapas para realização do Teste de Tukey

.pull-right-3[
<br><br><br>
![question](https://media1.giphy.com/media/ZaJtnTY8tFZz0PvmW9/giphy-downsized.gif)  

]

--

.pull-left-3[
.font80[
**Etapa 1**: Execute a ANOVA e avalie o teste F nos dados experimentais. .green[Se a hipótese H<sub>0</sub> do teste F for rejeitada], proceda a realização de testes de comparações de médias.
<br>

**Etapa 2**: Calcular as médias aritméticas de cada tratamento. Para facilitar a realização das comparações, dispor as médias em ordem decrescente de valor.
<br>

**Etapa 3**: Calcular a Diferença Mínima Significativa ( $\Delta$ ).
<br>

**Etapa 4**: Calcular a diferença entre as médias aritméticas dos tratamentos (par-a-par).
<br>

**Etapa 5**: Comparar as diferenças entre as médias aritméticas com o valor de $\Delta$.
<br>

$\left | m_i - m_i \right | \geq \Delta$: Rejeita-se H<sub>0</sub> do teste de Tukey
<br>

$\left | m_i - m_i \right | < \Delta$: Não rejeita-se H<sub>0</sub> do teste de Tukey
<br>

**Etapa 6**: Indicar a significância entre dois tratamentos atribuindo-se letras diferentes para ambos, e a igualdade entre eles atribuindo-se a mesma letra para ambos.

]
]


---
name: ttdic
## Teste de comparações de médias de Tukey
<br>
### .font80[Teste Tukey - Experimento em DIC (Pimentel-Gomes; Garcia, 2002)]

.pull-left-3[
.font80[
- Vamos retornar ao experimento de competição de progênies (Pimentel-Gomes; Garcia, 2002) apresentado na Aula 4 (Delineamento Inteiramente Casualizado - DIC).
- Trata-se de um experimento de competição de 10 progênies de *Eucalyptus saligna* conduzido em DIC, com 4 repetições.
- Os dados são os valores médios de diâmetro a 1,30m do solo, em centímetros, nas parcelas experimentais.
]
]

---
name: data
## Teste de comparações de médias de Tukey
<br>
### .font80[Teste Tukey - Experimento em DIC (Pimentel-Gomes; Garcia, 2002)]
<br>

.pull-left-4[
.pull-top[
.font70[**Valores médios de diâmetro a 1,30m do solo, em centímetros...**]
<br>
```{r tibble, echo=F, eval=T}
data <- readr::read_csv("data/DIC-Pimentel-Gomes-2002.csv")
data %>% Customkbl
```
]
]

--

.pull-right-4[
.pull-down[
```{r echo=F, eval=T, collapse=T, out.width="25%", fig.align='center', fig.cap='', dpi=600}

df <- data %>%
  tidyr::pivot_longer(
        cols = starts_with("P"),
        names_to = "Progenie",
        values_to = "Valor",
        names_transform = list(Progenie = as.factor),
        values_drop_na = TRUE
    ) %>%
  rename(Repeticao = `Rep./Prog.`) %>% 
  mutate(Progenie = forcats::fct_reorder(
    Progenie, 
    desc(Valor), 
    .fun='mean')
    )
```

```{r echo=F, eval=T, collapse=T, fig.align='center', fig.cap='', dpi=600, fig.width=.8, fig.height=.8}

bp <- df %>%
  ggplot(aes(x=Progenie, y=Valor, color=Progenie)) +
  geom_boxplot() +
  stat_summary(fun.y=mean, geom="point", shape=4,
                 size=2, color="red") +
  theme_bw(base_size = 16) +
  theme(panel.grid = element_blank(),
        legend.position="none"
        )

plotly::ggplotly(bp)
```
]
]

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste Tukey - Experimento em DIC (Pimentel-Gomes; Garcia, 2002)]
<br>
.font90[
**Etapa 1**: Execute a ANOVA e avalie o teste F nos dados experimentais. .green[Se a hipótese H<sub>0</sub> do teste F for rejeitada], proceda a realização de testes de comparações de médias.
]
<br>

--

.pull-left-4[
.font80[
`r anicon::faa("hand-point-right", animate="horizontal")` **Lembre**: Esta etapa foi discutida na Aula 4 (DIC). Portanto, a ANOVA e o teste F já foram realizados. Vamos apenas resgatar o quadro de ANOVA e a conclusão do teste F...
]
]

--

.pull-right-4[
```{r, echo=FALSE, out.width='110%', fig.align='center', fig.cap='', dpi=600}
knitr::include_graphics('fig/class4/ANOVA-Final.png')
```
]

--

.pull-left-4[

.center[**Interpretação**]

.font70[
- Como $\large F_{Calculado}~>~F_{Crítico}~(~6,91~>~3,07)$ rejeita-se a hipótese de nulidade (H<sub>0</sub>). Portanto, existem evidências de que as médias de pelo menos dois tratamentos (Progênies) diferem estatísticamente, ao nível de 5% de probabilidade.
]
]

--

.pull-right-4[
.font70[**.green[Quais tratamentos possuem médias iguais e diferentes entre si?]**]
]

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste Tukey - Experimento em DIC (Pimentel-Gomes; Garcia, 2002)]
<br>
.font90[
**Etapa 2**: Calcular as médias aritméticas dos diâmetros para cada progênie, e dispor em ordem decrescente.
]
<br>

.pull-left-9[
```{r tb1, echo=F, eval=T}
library(dplyr)
data <- readr::read_csv("data/DIC-Pimentel-Gomes-2002.csv")

df1 <- data %>% 
  bind_rows(data %>%
            summarise_if(is.numeric, mean)) %>% 
  mutate(`Rep./Prog.` = ifelse(is.na(`Rep./Prog.`), "Média", `Rep./Prog.`)) %>% 
  mutate_if(is.numeric, round, 1)

df1 %>%
  Customkbl %>%
  row_spec(5, color = 'white', background = 'orange')
```

.font70[
<br>
`r anicon::faa("thumbs-up", animate="bounce")` **Por coincidência (ou não), as médias já estão em ordem.**

]
]

--

.pull-right-9[
```{r, echo=F, eval=T}
df2 <- df1 %>%
  as_tibble() %>%
  slice(c(0, n())) %>%
  select(-`Rep./Prog.`) %>% 
  tidyr::pivot_longer(cols=everything(),
                      names_to = "Progênies",
                      values_to = "Médias") %>% 
  arrange()

 df2 %>% 
  CustomDT2
```
]

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste Tukey - Experimento em DIC (Pimentel-Gomes; Garcia, 2002)]
<br>
.font90[
**Etapa 3**: Calcular a Diferença Mínima de Significância
]

--

.pull-left-4[
.font80[
- Primeiro, vamos encontrar o valor de *q*<sub>*crítico*</sub> no site: <br> [q-Distribution-Tables-elvers](http://elvers.us/stats/tables/qprobability.html)
- Vamos admitir $α = 0,05$, conforme Pimentel-Gomes e Garcia, 2002.
]<br>

$$
\begin{equation*}
q_{(I;~GLR,~\alpha)}\\
q_{(10;~30,~0,05)} = \color{red}{4,825}
\end{equation*}
$$
]

--

.pull-right-4[
$$
\begin{equation*}
\normalsize
\Delta = q\sqrt{\frac{QMR}{J}} = 4,825\sqrt{\frac{2,59}{4}} = \color{red}{3,88cm}
\end{equation*}
$$
.font70[
*QMR* = Quadrado Médio do Resíduo

*J* = Número de repetições por tratamento
]
]

--

.pull-right-4[
<br>
.shadow[
.font70[
.center[**Interpretação**]
- Quando a diferença entre as médias de dois tratamentos for no mínimo de 3,88cm, existem evidências para admitir uma diferença significativa entre estas médias.
]
]

]

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste Tukey - Experimento em DIC (Pimentel-Gomes; Garcia, 2002)]
<br>
.font90[
**Etapas 4 e 5**: Calcular a diferença entre as médias aritméticas das progênies (par-a-par) e comparar com DMS
]

--

.pull-left-4[
.font70[
.blue[**Progênie 1 vs demais progênies**]
]
```{r echo=FALSE, eval=T}
df3 <- data.frame(
  Pi = rep("P1", 9), 
  Pcomp = rep(paste0("P", 2:10), 1), 
  mi = rep(14.5, 9), 
  mcomp = df2$Médias[2:10]) %>% 
  mutate(Diferenca = round(mi - mcomp, 2),
         DMS = rep(3.88, 9),
         Conclusao = c(if_else(Diferenca >= DMS, 
                               "Rejeita-se H0", 
                               "Não rejeita-se H0"))
         )
    
df3 %>% CustomDT %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = DT::styleEqual(
      unique(df3$Conclusao), c('lightblue', 'lightgreen')
    )
  )
```

]

--

.pull-right-4[
.font70[
.blue[**Progênie 2 vs demais progênies**]
]
```{r echo=FALSE, eval=T}
df4 <- data.frame(
  Pi = rep("P2", 8), 
  Pcomp = rep(paste0("P", 3:10), 1), 
  mi = rep(14.3, 8), 
  mcomp = df2$Médias[3:10]) %>% 
  mutate(Diferenca = round(mi - mcomp, 2),
         DMS = rep(3.88, 8),
         Conclusao = c(if_else(Diferenca >= DMS, 
                               "Rejeita-se H0", 
                               "Não rejeita-se H0"))
         )

df4 %>% 
  CustomDT %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = DT::styleEqual(
      unique(df4$Conclusao), c('lightblue', 'lightgreen')
    )
  )
```

]

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste Tukey - Experimento em DIC (Pimentel-Gomes; Garcia, 2002)]
<br>
.font90[
**Etapas 4 e 5**: Calcular a diferença entre as médias aritméticas das progênies (par-a-par) e comparar com DMS
]

--

.pull-left-4[
.font70[
.blue[**Progênie 3 vs demais progênies**]
]
```{r echo=FALSE, eval=T}
df5 <- data.frame(
  Pi = rep("P3", 7), 
  Pcomp = rep(paste0("P", 4:10), 1), 
  mi = rep(14.2, 7), 
  mcomp = df2$Médias[4:10]) %>% 
  mutate(Diferenca = round(mi - mcomp, 2),
         DMS = rep(3.88, 7),
         Conclusao = c(if_else(Diferenca >= DMS, 
                               "Rejeita-se H0", 
                               "Não rejeita-se H0"))
         )
    
df5 %>% CustomDT %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = DT::styleEqual(
      unique(df5$Conclusao), c('lightblue', 'lightgreen')
    )
  )
```

]

--

.pull-right-4[
.font70[
.blue[**Progênie 4 vs demais progênies**]
]
```{r echo=FALSE, eval=T}
df6 <- data.frame(
  Pi = rep("P4", 6), 
  Pcomp = rep(paste0("P", 5:10), 1), 
  mi = rep(14.1, 6), 
  mcomp = df2$Médias[5:10]) %>% 
  mutate(Diferenca = round(mi - mcomp, 2),
         DMS = rep(3.88, 6),
         Conclusao = c(if_else(Diferenca >= DMS, 
                               "Rejeita-se H0", 
                               "Não rejeita-se H0"))
         )

df6 %>% 
  CustomDT %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = DT::styleEqual(
      unique(df6$Conclusao), c('lightblue', 'lightgreen')
    )
  )
```

]

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste Tukey - Experimento em DIC (Pimentel-Gomes; Garcia, 2002)]
<br>
.font90[
**Etapas 4 e 5**: Calcular a diferença entre as médias aritméticas das progênies (par-a-par) e comparar com DMS
]

--

.pull-left-4[
.font70[
.blue[**Progênie 5 vs demais progênies**]
]
```{r echo=FALSE, eval=T}
df7 <- data.frame(
  Pi = rep("P5", 5), 
  Pcomp = rep(paste0("P", 6:10), 1), 
  mi = rep(13, 5), 
  mcomp = df2$Médias[6:10]) %>% 
  mutate(Diferenca = round(mi - mcomp, 2),
         DMS = rep(3.88, 5),
         Conclusao = c(if_else(Diferenca >= DMS, 
                               "Rejeita-se H0", 
                               "Não rejeita-se H0"))
         )
    
df7 %>% CustomDT %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = DT::styleEqual(
      unique(df7$Conclusao), c('lightblue', 'lightgreen')
    )
  )
```

]

--

.pull-right-4[
.font70[
.blue[**Progênie 6 vs demais progênies**]
]
```{r echo=FALSE, eval=T}
df8 <- data.frame(
  Pi = rep("P6", 4), 
  Pcomp = rep(paste0("P", 7:10), 1), 
  mi = rep(12.4, 4), 
  mcomp = df2$Médias[7:10]) %>% 
  mutate(Diferenca = round(mi - mcomp, 2),
         DMS = rep(3.88, 4),
         Conclusao = c(if_else(Diferenca >= DMS, 
                               "Rejeita-se H0", 
                               "Não rejeita-se H0"))
         )

df8 %>% 
  CustomDT %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = 'lightblue'
  )
```

]

--

.pull-down[
.pull-left-4[
.font70[
.blue[**Progênie 7 vs demais progênies**]
]
```{r echo=FALSE, eval=T}
df9 <- data.frame(
  Pi = rep("P7", 3), 
  Pcomp = rep(paste0("P", 8:10), 1), 
  mi = rep(12.1, 3), 
  mcomp = df2$Médias[8:10]) %>% 
  mutate(Diferenca = round(mi - mcomp, 2),
         DMS = rep(3.88, 3),
         Conclusao = c(if_else(Diferenca >= DMS, 
                               "Rejeita-se H0", 
                               "Não rejeita-se H0"))
         )

df9 %>% 
  CustomDT %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = 'lightblue'
  )
```

]
]

--


.pull-right-4[
.pull-down[
.font70[
.blue[**Progênie 8 vs demais progênies**]
]
```{r echo=FALSE, eval=T}
df10 <- data.frame(
  Pi = rep("P8", 2), 
  Pcomp = rep(paste0("P", 9:10), 1), 
  mi = rep(11.7, 2), 
  mcomp = df2$Médias[9:10]) %>% 
  mutate(Diferenca = round(mi - mcomp, 2),
         DMS = rep(3.88, 2),
         Conclusao = c(if_else(Diferenca >= DMS, 
                               "Rejeita-se H0", 
                               "Não rejeita-se H0"))
         )

df10 %>% 
  CustomDT %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = 'lightblue'
  )
```


.font70[
.blue[**Progênie 9 vs Progênie 10**]
]
```{r echo=FALSE, eval=T}
df11 <- data.frame(
  Pi = rep("P9", 1), 
  Pcomp = rep(paste0("P", 10), 1), 
  mi = rep(9, 1), 
  mcomp = df2$Médias[10]) %>% 
  mutate(Diferenca = round(mi - mcomp, 2),
         DMS = rep(3.88, 1),
         Conclusao = c(if_else(Diferenca >= DMS, 
                               "Rejeita-se H0", 
                               "Não rejeita-se H0"))
         )

df11 %>% 
  CustomDT %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = 'lightblue'
  )
```

]
]

---

## Teste de comparações de médias de Tukey

.pull-left-4[
```{r, echo=F}
bind_rows(df3, df4, df5) %>% 
  CustomDT2 %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = DT::styleEqual(
      unique(df7$Conclusao), c('lightblue', 'lightgreen')
    )
  )
```
]

--

.pull-right-4[
```{r, echo=F}
bind_rows(df6, df7, df8, 
          df9, df10, df11) %>% 
  CustomDT2 %>% 
    DT::formatStyle(
    'Conclusao',
    backgroundColor = DT::styleEqual(
      unique(df7$Conclusao), c('lightblue', 'lightgreen')
    )
  )
```

.center[**Tabela Final**]
]

---

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste Tukey - Experimento em DIC (Pimentel-Gomes; Garcia, 2002)]
<br>
.font90[
**Etapa 6**: Indicar a significância entre dois tratamentos atribuindo-se letras diferentes para ambos, e a igualdade entre eles atribuindo-se a mesma letra para ambos.
]

--
<br>

.pull-left-4[
```{r echo=FALSE}
tb <- tibble::tibble(
  Progênie = rep(paste0("P", 1:10), 1),
  Média = df2$Médias
) %>% 
  mutate(`Tukey (5%)` = case_when(
   Média >= 13 ~ "a",
   Média < 10 ~ "b",
   Média > 9 & Média < 13 ~ "ab"
    ))

tb %>% 
  CustomDT
```
]

.pull-right-4[
.font80[
- As médias seguidas por letras distintas diferem significativamente ao nível de 5% de significância, de acordo com o Teste de Tukey.
- Existem evidência para admitir que a média da progênie P1 é estatísticamente diferente apenas de P9 e P10. (.magenta[Escreva afirmações como essa para as demais evidências indicadas pelo teste de Tukey])

]
]

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste de Tukey no R - Pacote agricolae]
<br>

.pull-left-4[
.font70[
- **1 - Carrega dados e manipula para formato longo...**
```{r echo=T, eval=T}
data <- readr::read_csv("data/DIC-Pimentel-Gomes-2002.csv")

data_pivot <- data %>%
  tidyr::pivot_longer(
    cols = starts_with("P"),
    names_to = "Progenie",
    values_to = "Valor",
    names_transform = list(Progenie = as.factor),
    values_drop_na = TRUE
  ) %>%
  rename(Repeticao = `Rep./Prog.`) %>%
  arrange(Progenie, Repeticao)
```
]
]

--

.pull-right-4[
.font70[
- **2 - Realiza ANOVA...**
```{r echo=T, eval=T}
# Realizar a análise de variância
res.aov <- aov(Valor ~ Progenie, data = data_pivot)

# Resumo da análise de variância
summary(res.aov)
```
]
]

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste de Tukey no R - Pacote agricolae]
<br>

.pull-left-4[
.font80[
- **3 - Realiza Teste de Tukey...**
```{r tukey, echo=T, eval=F}
# Teste Tukey
library(agricolae)
out.tukey <- HSD.test(y = res.aov, trt = "Progenie", 
                      group = TRUE, alpha = 0.05)

out.tukey$groups
out.tukey$parameters
```
]
]

.pull-right-4[
.font90[
```{r ref.label="tukey", echo=FALSE, eval=TRUE, collapse=F}
```
]
]

---

## Teste de comparações de médias de Tukey
<br>
### .font80[Teste de Tukey no R - Pacote agricolae]

.pull-left-4[
.font80[
- **4 - Gráfico do Teste de Tukey...**
```{r plotukey, echo=T, eval=F}
# Gráfico comparações de Tukey
plot(out.tukey, ylab = "Diâmetro (cm)",
     main = "Competição de Progênies\n (Eucalyptus saligna)")
```
]
]

.pull-right-4[
```{r ref.label="plotukey", echo=FALSE, eval=TRUE, out.width='85%', fig.align='center'}
```
]

---

layout: false
name: conc
class: inverse, top, right
background-image: url(fig/class3/arara2.jpg)
background-size: cover

.font200[**.yellow[Parte 3] <br> .white[Teste de comparações <br> múltiplas de Duncan]**] 

.left[.footnote[.white[Créditos: Imagem de ljwong por Pixabay].]]

---

layout: true
<div class="my-header"></div>
<div class="my-footer"><span>Prof. Dr. Deivison Venicio Souza (E-mail: deivisonvs@ufpa.br)&emsp;&emsp;&emsp;&emsp;&emsp; <div3>Experimentação Florestal (FL03034 - EF) </div3>/ <div2>Testes de Comparações de Médias</div2> </div>

---

name: td
## Teste de comparações de médias de Duncan
<br>
### David B. Duncan

.pull-left-2[
.font80[
- Foi idealizado por [David B. Duncan](https://en.wikipedia.org/wiki/Duncan%27s_new_multiple_range_test) em 1955.
- **Publicação**: *Multiple range and multiple F tests*
[(Duncan, 1955)](https://www.jstor.org/stable/3001478?origin=crossref&seq=1#metadata_info_tab_contents).
- **Ideia básica**: comparar pares de médias de tratamentos, porém 
- É conhecido como .green[Teste de Amplitudes Múltiplas de Duncan] (*Duncan's New Multiple Range Test* - MRT).
- É mais trabalhoso do que o Teste de Tukey, pois exige o cálculo de várias amplitudes (diferenças entre médias) mínimas significativas.
- Tem a tendência de indicar diferenças significativas entre médias com mais facilidade.
- Pode indicar diferenças significativas entre médias em casos em que o Teste de Tukey não mostra.
]
]

---
name: dms
## Teste de comparações de médias de Duncan
<br>
### Amplitude Mínima Significante - R<sub>m</sub>
<br>

.pull-left-4[
$$
\begin{equation*}
\Large
R_m = z_m\sqrt{\frac{QMR}{r}}
\end{equation*}
$$
<br>
.font70[
$R_m$ = Amplitude Mínima Significante

$z_m$ = Amplitude Mínima Estudentizada, ao  nível de significância $\alpha$.

$QMR$ = Quadrado Médio do Resíduo

$r$ = Número de repetições por tratamento
]
]

.pull-right-4[
.center[**Amplitude Mínima Estudentizada**]

$$
\begin{equation*}
z_{(I;~GLR,~\alpha)}
\end{equation*}
$$

.font70[
$I$ = Número de médias abrangidas pelo intervalo do contraste

$GLR$ = Graus de liberdade de Resíduos (ou Erro Experimental)
<br><br>

- Encontre o valor de $z$ crítico no site: [Critical values for Duncan's multiple range tests](http://users.stat.ufl.edu/~winner/tables/duncan_mrt.txt)

]
]

---
name: hetd
## Teste de comparações de médias de Duncan
<br>
### Hipóteses estatísticas do Teste de Duncan
<br>

.pull-left-10[
.font90[
**Hipótese de nulidade (H<sub>0</sub>):**
<br>

- As .green[médias] comparadas .green[não diferem] significativamente.

H<sub>0</sub>: $m_i - m_{i'} = 0$, para algum $i ≠ i'$

]
]

.pull-left-10[
.font90[
**Hipótese de alternativa (H<sub>1</sub>):**
<br>

- As .green[médias] comparadas .green[diferem] significativamente.

H<sub>1</sub>: $m_i - m_{i'} ≠ 0$, para algum $i ≠ i'$
]
]

---
name: rdtd
## Teste de comparações de médias de Duncan
<br>
### Regras de decisão do teste de Duncan
<br>

.pull-left-10[
.font90[
**Rejeição da hipótese de nulidade (H<sub>0</sub>)**

- Se $\left | m_i - m_{i'} \right | \geq R_m$, rejeita-se (H<sub>0</sub>). 
- Em outras palavras, .green[existem evidências] de que as médias comparadas são diferentes, ao nível de significância $\alpha$.
]
]

.pull-right-10[
.font90[
**Não rejeição da hipótese de nulidade**

- Se $\left | m_i - m_{i'} \right | < R_m$, não rejeita-se (H<sub>0</sub>). 
- Em outras palavras, .green[não existem evidências] de que as médias comparadas são diferentes, ao nível de significância $\alpha$.

]
]

---
name: ertd
## Teste de comparações de médias de Duncan
<br>
### Etapas para realização do Teste de Duncan

.pull-right-3[
<br><br><br>
![question](https://media1.giphy.com/media/ZaJtnTY8tFZz0PvmW9/giphy-downsized.gif)  

]

--

.pull-left-3[
.font80[
**Etapa 1**: Execute a ANOVA e avalie o teste F nos dados experimentais. .green[Se a hipótese H<sub>0</sub> do teste F for rejeitada], proceda a realização de testes de comparações de médias.
<br>

**Etapa 2**: Calcular as médias aritméticas de cada tratamento. Para facilitar a realização das comparações, dispor as médias em ordem decrescente de valor.
<br>

**Etapa 3**: Calcular a Diferença Mínima Significativa ( $\Delta$ ).
<br>

**Etapa 4**: Calcular a diferença entre as médias aritméticas dos tratamentos (par-a-par).
<br>

**Etapa 5**: Comparar as diferenças entre as médias aritméticas com o valor de $\Delta$.
<br>

$\left | m_i - m_i \right | \geq \Delta$: Rejeita-se H<sub>0</sub> do teste de Tukey
<br>

$\left | m_i - m_i \right | < \Delta$: Não rejeita-se H<sub>0</sub> do teste de Tukey
<br>

**Etapa 6**: Indicar a significância entre dois tratamentos atribuindo-se letras diferentes para ambos, e a igualdade entre eles atribuindo-se a mesma letra para ambos.

]
]

---

## Teste de comparações de médias de Duncan
<br>
### .font80[Teste Duncan - Experimento em DIC (Banzatto; Kronka, 2013)]

.pull-left-9[
.font80[
- Vamos usar dados de um experimento em DIC disponível em Banzatto e Kronka (2013; pg. 64).
- Os dados estão facilmente acessíveis no pacote **labestData**. Execute o código: labestData::BanzattoQd3.7.1
- O experimento objetivou avaliar 5 composições de substratos (com 4 repetições) no desenvolvimento em altura de *Pinus oocarpa*.
- A variável resposta é a altura média, em cm, das plântulas 60 dias após a semeadura.
]
]

--

.pull-right-9[
.font70[
.center[**Composição de Substratos (Tratamentos)**]
<br><br>

**SC** = Solo de Cerrado

**SC+E** = Solo de Cerrado com Esterco

**SC+E+NPK** = Solo de Cerrado com Esterco e com NPK

**SC+V** = Solo de Cerrado com Vermiculita

**SC+V+NPK** = Solo de Cerrado com Vermiculita e com NPK
]
]

---

## Teste de comparações de médias de Duncan
<br>
### .font80[Teste Duncan - Experimento em DIC (Banzatto; Kronka, 2013) - Dados do experimento]


```{r echo=T, eval=F}
labestData::BanzattoQd3.7.1
```


---

## Referências
.font90[
<br><br>
DIAS, L. A. dos S.; BARROS, W. S. Biometria experimental. Viçosa, MG: Suprema, 2009. 408 p.
<br><br>
NOGUEIRA, M. C. S. Experimentação agronômica I: conceitos, planejamento e análise estatística. Piracicaba, 479 p. 2007.
<br><br>
PIMENTEL-GOMES, F.; GARCIA, C. H. Estatística aplicada a experimentos agronômicos e florestais: exposição com exemplos e orientações para uso de aplicativos. Piracicaba: FEALQ, 2002. 309 p.
<br><br>
ROSSETTI, A. G.; VIDAL NETO, F. D. C.; MELO, D.; SERRANO, L.; HAWERROTH, F.; TANIGUCHI, C., ... & BEZERRA, M. Orientações para instalação, condução e avaliação de experimentos de campo. Fortaleza: Embrapa Agroindústria Tropical, 2017. 85p.
]

<!--Slide XX -->
---
layout: false
class: inverse, top, right
background-image: url(fig/class1/imgC.jpg)
background-size: cover

.font300[
Obrigado!
]
<br><br><br><br><br><br>

**Email**: <a href="mailto:deivisonvs@ufpa.br">deivisonvs@ufpa.br</a>

**Github**: <a href="https://github.com/DeivisonSouza">@DeivisonSouza</a>
